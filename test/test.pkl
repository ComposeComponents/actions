amends "../src/render.pkl"
import "../src/common/base.pkl" as base
import "../src/common/build-app-support.pkl" as support
import "../src/common/target.pkl" as target

_modules = new Listing {
    "serializable"
}

workflows = new Listing {
    import("../src/build-lib.pkl")
    (import("../src/build-app.pkl")) {
        apkBuildDescriptors = List(
            support.debugBuildDescriptor("app"),
            support.debugBuildDescriptor("feature:thing1"),
            support.debugBuildDescriptor("feature:thing2"),
            support.debugBuildDescriptor("feature:thing3")
        )

        aabBuildDescriptors = List(
            support.releaseBuildDescriptor("app", false),
            support.releaseInstantBuildDescriptor("app", true)
        )
    }
    (import("../src/build-app.pkl")) {
        name = "Build App No Instant"

        apkBuildDescriptors = List(
            support.debugBuildDescriptor("app"),
            support.debugBuildDescriptor("feature:thing1"),
            support.debugBuildDescriptor("feature:thing2"),
            support.debugBuildDescriptor("feature:thing3")
        )

        aabBuildDescriptors = List(
            support.releaseBuildDescriptor("app", false)
        )

        releaseTrackPublishingConfiguration = List(
            new support.AppReleaseDescriptor {
                appModule = "app"
                packageName = "com.example"
            }
        )

        extraBuildSteps = new Listing {
            new base.CommandStep {
                run = "echo \"test\""
            }
        }
    }
    (import("../src/build-kmp-lib.pkl")) {
        name = "Build KMP Library"

        targets = new Listing {
            target.buildIosMultiplatformTarget("serializable", "x64")
            target.buildIosMultiplatformTarget("serializable", "arm64")
            target.buildIosMultiplatformTarget("serializable", "simulatorArm64")
            target.buildDarwinMultiplatformTarget("serializable", "macos", "x64")
            target.buildDarwinMultiplatformTarget("serializable", "macos", "arm64")
            target.buildDarwinMultiplatformTarget("serializable", "watchos", "x64")
            target.buildDarwinMultiplatformTarget("serializable", "watchos", "arm32")
            target.buildDarwinMultiplatformTarget("serializable", "watchos", "arm64")
            target.buildDarwinMultiplatformTarget("serializable", "watchos", "simulatorArm64")
            target.buildDarwinMultiplatformTarget("serializable", "tvos", "x64")
            target.buildDarwinMultiplatformTarget("serializable", "tvos", "arm64")
            target.buildDarwinMultiplatformTarget("serializable", "tvos", "simulatorArm64")
            target.buildAndroidMultiplatformTarget("serializable")
            target.buildJvmMultiplatformTarget("serializable")
            target.buildWasmJsMultiplatformTarget("serializable")
            target.buildWasmWasiMultiplatformTarget("serializable")
            target.buildMing64WMultiplatformTarget("serializable")
            target.buildLinuxMultiplatformTarget("serializable", "x64")
            target.buildLinuxMultiplatformTarget("serializable", "arm64")
        }
    }
    import("../src/build-pkl.pkl")
    import("../src/lint.pkl")
    import("../src/test.pkl")
}